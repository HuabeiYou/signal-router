{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ title }}</h4>
<form method="post" action="{{ form_action }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
  <div class="mb-3">
    <label class="form-label">规则名称</label>
    <input class="form-control" name="name" value="{{ rule.name if rule else '' }}" required>
  </div>
  <div class="mb-3">
    <label class="form-label">优先级（越大越先匹配）</label>
    <input class="form-control" type="number" name="priority" value="{{ rule.priority if rule else 0 }}">
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" name="enabled" id="enabled" {% if rule is none or rule.enabled %}checked{% endif %}>
    <label class="form-check-label" for="enabled">启用规则</label>
  </div>
  <div class="mb-3">
    <label class="form-label">匹配方式</label>
    <select class="form-select" name="condition_type">
      <option value="always" {% if condition_type == "always" %}selected{% endif %}>全部消息（无条件命中）</option>
      <option value="contains_text" {% if condition_type == "contains_text" %}selected{% endif %}>消息内容包含关键词</option>
      <option value="contains_field" {% if condition_type == "contains_field" %}selected{% endif %}>消息里包含字段名（如 symbol）</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">匹配内容</label>
    <input class="form-control" name="condition_value" value="{{ condition_value }}" placeholder="根据上面的匹配方式填写">
    <div class="form-text">
      示例：<br>
      1) 选择“全部消息（无条件命中）”：此处留空。<br>
      2) 选择“消息内容包含关键词”：填写 <code>ETF动量模型推送</code>。<br>
      3) 选择“消息里包含字段名（如 symbol）”：<br>
      如果消息里有 <code>symbol=501018</code>，就填写 <code>symbol</code>；<br>
      如果消息里有 <code>side=BUY</code>，就填写 <code>side</code>。
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">目标Webhook（每行一个）</label>
    <textarea class="form-control" rows="5" name="target_urls" required>{{ targets_text }}</textarea>
  </div>
  <button class="btn btn-primary" type="submit">保存</button>
  <a class="btn btn-outline-secondary" href="/admin/rules">返回</a>
</form>
{% endblock %}
