{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ title }}</h4>
<form method="post" action="{{ form_action }}">
  <div class="mb-3">
    <label class="form-label">规则名称</label>
    <input class="form-control" name="name" value="{{ rule.name if rule else '' }}" required>
  </div>
  <div class="mb-3">
    <label class="form-label">优先级（越大越先匹配）</label>
    <input class="form-control" type="number" name="priority" value="{{ rule.priority if rule else 0 }}">
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" name="enabled" id="enabled" {% if rule is none or rule.enabled %}checked{% endif %}>
    <label class="form-check-label" for="enabled">启用规则</label>
  </div>
  <div class="mb-3">
    <label class="form-label">匹配类型</label>
    <select class="form-select" name="condition_type">
      <option value="always" {% if condition_type == "always" %}selected{% endif %}>always（所有消息）</option>
      <option value="contains_text" {% if condition_type == "contains_text" %}selected{% endif %}>contains_text（内容包含关键词）</option>
      <option value="contains_field" {% if condition_type == "contains_field" %}selected{% endif %}>contains_field（字段存在）</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">匹配值（always 可留空；contains_text 填关键词；contains_field 填字段名）</label>
    <input class="form-control" name="condition_value" value="{{ condition_value }}">
  </div>
  <div class="mb-3">
    <label class="form-label">目标Webhook（每行一个）</label>
    <textarea class="form-control" rows="5" name="target_urls" required>{{ targets_text }}</textarea>
  </div>
  <button class="btn btn-primary" type="submit">保存</button>
  <a class="btn btn-outline-secondary" href="/admin/rules">返回</a>
</form>
{% endblock %}
